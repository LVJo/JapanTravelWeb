<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 日本之旅 | Minimalist</title>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        lake: {
                            50: '#f0f9f8',
                            100: '#dcfce7', // 淺綠底
                            300: '#86efac', 
                            500: '#2dd4bf', // 主要湖水綠
                            600: '#0d9488', // 深湖水綠
                            800: '#115e59', // 文字深綠
                        },
                        stone: {
                            50: '#fafaf9',
                            100: '#f5f5f4',
                            800: '#292524',
                        }
                    },
                    fontFamily: {
                        sans: ['Noto Sans TC', 'sans-serif'],
                        num: ['Lexend', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #fafaf9; color: #292524; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* 平滑滾動與貼齊 */
        .snap-x-mandatory { scroll-snap-type: x mandatory; }
        .snap-center { scroll-snap-align: center; }

        /* 極簡轉場 */
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
</head>
<body>

<div id="app" class="relative min-h-screen flex justify-center bg-[#e5e5e5]">
    
    <div class="w-full max-w-md h-[100dvh] bg-stone-50 relative shadow-2xl flex flex-col overflow-hidden">
        
        <header class="pt-14 pb-2 px-6 bg-stone-50/90 backdrop-blur-sm sticky top-0 z-20 flex justify-between items-end border-b border-stone-100">
            <div>
                <p class="text-xs text-lake-600 font-bold tracking-widest uppercase mb-1">Japan Trip 2026</p>
                <h1 class="text-2xl font-bold text-stone-800 tracking-tight">{{ currentTabTitle }}</h1>
            </div>
            <div class="flex items-center gap-3">
                <div class="text-xs text-right hidden sm:block">
                    <p class="font-num text-stone-500">Mar 28</p>
                    <p class="font-num text-stone-500">Apr 05</p>
                </div>
                <div class="w-10 h-10 rounded-full border border-lake-200 flex items-center justify-center text-lake-600 bg-white">
                    <i class="fa-regular fa-user"></i>
                </div>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto no-scrollbar relative">
            
            <div v-if="currentTab === 'schedule'" class="pb-24">
                
                <div class="sticky top-0 z-10 bg-stone-50/95 backdrop-blur-sm py-4 border-b border-stone-100 shadow-sm">
                    <div class="flex overflow-x-auto no-scrollbar snap-x-mandatory px-6 gap-6 items-center" id="date-scroll">
                        <div v-for="(day, index) in tripDays" :key="index" 
                            @click="selectDate(index)"
                            class="snap-center flex flex-col items-center cursor-pointer transition-all duration-300 group min-w-[3rem]"
                            :class="activeDate === index ? 'opacity-100 scale-110' : 'opacity-40 hover:opacity-70'">
                            <span class="text-[10px] font-bold tracking-wide mb-1" :class="activeDate === index ? 'text-lake-600' : 'text-stone-400'">{{ day.dayName }}</span>
                            <div class="w-10 h-10 rounded-full flex items-center justify-center font-num text-lg transition-all duration-300"
                                :class="activeDate === index ? 'bg-lake-500 text-white shadow-lg shadow-lake-500/40' : 'bg-transparent text-stone-600'">
                                {{ day.dateShort.split('/')[1] }}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="px-6 py-6 space-y-6">
                    <div v-if="tripDays[activeDate].events.length === 0" class="flex flex-col items-center justify-center py-12 opacity-30">
                        <i class="fa-thin fa-calendar text-5xl mb-4"></i>
                        <p class="font-light">No Plans Yet</p>
                    </div>

                    <div v-for="(event, idx) in tripDays[activeDate].events" :key="idx" 
                        class="relative pl-6 border-l border-stone-200 last:border-0 pb-2 group">
                        
                        <div class="absolute -left-[5px] top-1 w-[9px] h-[9px] rounded-full bg-white border-2 border-lake-400 z-10"></div>
                        
                        <div class="bg-white rounded-xl p-5 shadow-soft hover:shadow-md transition-shadow duration-300 border border-stone-100">
                            <div class="flex justify-between items-start mb-2">
                                <span class="font-num text-lake-600 font-medium text-sm bg-lake-50 px-2 py-0.5 rounded">{{ event.time }}</span>
                                <div class="flex items-center gap-1.5 text-stone-400 text-xs bg-stone-50 px-2 py-1 rounded-full">
                                    <i :class="getWeatherIcon(event.time)" class="text-lake-400"></i>
                                    <span class="font-num">{{ getTemp(event.time) }}°C</span>
                                </div>
                            </div>
                            
                            <h3 class="text-stone-800 font-bold text-lg mb-1">{{ event.title }}</h3>
                            
                            <div class="flex justify-between items-end">
                                <p class="text-sm text-stone-500 font-light flex items-center">
                                    <i class="fa-solid fa-location-dot mr-1.5 text-xs opacity-50"></i>{{ event.location }}
                                </p>
                                <button @click="deleteEvent(idx)" class="text-stone-300 hover:text-red-400 transition-colors text-sm">
                                    <i class="fa-regular fa-trash-can"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <button @click="showAddModal = true" class="fixed bottom-24 right-6 w-14 h-14 bg-lake-800 text-white rounded-full shadow-xl shadow-lake-800/30 flex items-center justify-center text-xl hover:scale-110 transition-transform z-20">
                    <i class="fa-solid fa-plus"></i>
                </button>
            </div>

            <div v-if="currentTab === 'money'" class="p-6 space-y-8 pb-24">
                <div class="text-center py-6">
                    <p class="text-xs text-stone-400 uppercase tracking-widest mb-2">Total Expenses</p>
                    <h2 class="text-5xl font-num font-light text-lake-800 tracking-tighter">
                        <span class="text-2xl align-top mr-1">¥</span>{{ totalExpense.toLocaleString() }}
                    </h2>
                </div>

                <div>
                    <h3 class="text-xs text-stone-400 uppercase tracking-widest mb-4">Settlement</h3>
                    <div class="bg-white rounded-2xl shadow-soft p-1 divide-y divide-stone-50">
                        <div v-if="settlements.length === 0" class="p-4 text-center text-stone-400 text-sm">All settled up.</div>
                        <div v-for="s in settlements" class="flex justify-between items-center p-4">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-full bg-stone-100 flex items-center justify-center text-xs font-bold text-stone-600">{{ s.from[0] }}</div>
                                <i class="fa-solid fa-arrow-right-long text-stone-300 text-xs"></i>
                                <div class="w-8 h-8 rounded-full bg-lake-100 flex items-center justify-center text-xs font-bold text-lake-700">{{ s.to[0] }}</div>
                            </div>
                            <span class="font-num font-bold text-lake-600">¥{{ Math.round(s.amount).toLocaleString() }}</span>
                        </div>
                    </div>
                </div>

                <div>
                    <h3 class="text-xs text-stone-400 uppercase tracking-widest mb-4">Add Expense</h3>
                    <div class="space-y-3">
                        <input v-model="newExpense.title" placeholder="Item Name" class="w-full bg-transparent border-b border-stone-200 p-3 outline-none focus:border-lake-500 transition-colors placeholder-stone-300">
                        <div class="flex gap-4">
                            <input v-model.number="newExpense.amount" type="number" placeholder="Amount (¥)" class="w-2/3 bg-transparent border-b border-stone-200 p-3 outline-none focus:border-lake-500 font-num">
                            <select v-model="newExpense.payer" class="w-1/3 bg-transparent border-b border-stone-200 p-3 outline-none focus:border-lake-500 text-stone-600">
                                <option v-for="m in members" :value="m">{{ m }}</option>
                            </select>
                        </div>
                        <button @click="addExpense" class="w-full mt-4 bg-stone-800 text-white py-4 rounded-xl font-medium hover:bg-stone-700 transition-colors text-sm tracking-wide">CONFIRM</button>
                    </div>
                </div>

                <div class="space-y-4">
                    <div v-for="(ex, idx) in expenses" class="flex justify-between items-center group">
                        <div class="flex items-center gap-3">
                            <div class="w-2 h-2 rounded-full bg-stone-300"></div>
                            <div>
                                <p class="text-stone-800 font-medium">{{ ex.title }}</p>
                                <p class="text-xs text-stone-400">Paid by {{ ex.payer }}</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-4">
                            <span class="font-num text-stone-600">¥{{ ex.amount.toLocaleString() }}</span>
                            <button @click="removeExpense(idx)" class="opacity-0 group-hover:opacity-100 transition-opacity text-stone-300 hover:text-red-400">
                                <i class="fa-solid fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'map'" class="p-6 space-y-4 pb-24">
                 <div v-for="loc in savedLocations" :key="loc.name" 
                    @click="openMap(loc.query)"
                    class="group relative h-40 rounded-2xl overflow-hidden cursor-pointer shadow-soft">
                    <div class="absolute inset-0 bg-stone-800"></div>
                    <div class="absolute inset-0 opacity-40 bg-gradient-to-tr from-lake-900 to-stone-500 group-hover:scale-105 transition-transform duration-700"></div>
                    
                    <div class="absolute inset-0 p-5 flex flex-col justify-between">
                        <div class="flex justify-between items-start">
                            <span class="bg-white/10 backdrop-blur-md px-3 py-1 rounded-full text-xs text-white border border-white/20">{{ loc.city }}</span>
                            <i class="fa-solid fa-arrow-up-right-from-square text-white/70"></i>
                        </div>
                        <div>
                            <p class="text-lake-300 text-xs font-medium mb-1">{{ loc.type }}</p>
                            <h3 class="text-white text-2xl font-bold tracking-tight">{{ loc.name }}</h3>
                        </div>
                    </div>
                </div>
            </div>

        </main>

        <nav class="absolute bottom-6 left-6 right-6 bg-white/90 backdrop-blur-md rounded-2xl px-6 py-4 shadow-[0_8px_30px_rgba(0,0,0,0.08)] z-30 border border-white/50 flex justify-between items-center">
            <button @click="currentTab = 'schedule'" :class="currentTab === 'schedule' ? 'text-lake-600 scale-110' : 'text-stone-300'" class="transition-all duration-300">
                <i class="fa-solid fa-layer-group text-xl"></i>
            </button>
            <div class="w-px h-6 bg-stone-100"></div>
            <button @click="currentTab = 'money'" :class="currentTab === 'money' ? 'text-lake-600 scale-110' : 'text-stone-300'" class="transition-all duration-300">
                <i class="fa-solid fa-wallet text-xl"></i>
            </button>
            <div class="w-px h-6 bg-stone-100"></div>
            <button @click="currentTab = 'map'" :class="currentTab === 'map' ? 'text-lake-600 scale-110' : 'text-stone-300'" class="transition-all duration-300">
                <i class="fa-solid fa-map text-xl"></i>
            </button>
        </nav>

        <div v-if="showAddModal" class="absolute inset-0 z-50 flex items-end justify-center pointer-events-none">
            <div class="absolute inset-0 bg-stone-900/20 backdrop-blur-[2px] pointer-events-auto" @click="showAddModal = false"></div>
            <div class="bg-white w-full rounded-t-3xl p-8 pb-10 pointer-events-auto transform transition-transform duration-300 translate-y-0 shadow-[0_-10px_40px_rgba(0,0,0,0.1)]">
                <h3 class="font-bold text-xl mb-6 text-stone-800">Add Plan</h3>
                <div class="space-y-5">
                    <div class="flex items-center border-b border-stone-100 py-2">
                        <i class="fa-regular fa-clock text-lake-500 w-8"></i>
                        <input v-model="newEvent.time" type="time" class="flex-1 outline-none text-stone-700 bg-transparent font-num">
                    </div>
                    <div class="flex items-center border-b border-stone-100 py-2">
                        <i class="fa-regular fa-bookmark text-lake-500 w-8"></i>
                        <input v-model="newEvent.title" placeholder="What to do?" class="flex-1 outline-none text-stone-700 bg-transparent placeholder-stone-300">
                    </div>
                    <div class="flex items-center border-b border-stone-100 py-2">
                        <i class="fa-solid fa-location-dot text-lake-500 w-8"></i>
                        <input v-model="newEvent.location" placeholder="Where?" class="flex-1 outline-none text-stone-700 bg-transparent placeholder-stone-300">
                    </div>
                    <button @click="addEvent" class="w-full bg-lake-600 text-white font-bold py-4 rounded-xl mt-4 shadow-lg shadow-lake-600/20 hover:bg-lake-700 transition-colors">SAVE</button>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    const { createApp, ref, computed } = Vue;

    createApp({
        setup() {
            const currentTab = ref('schedule');
            const showAddModal = ref(false);
            const activeDate = ref(0);

            // 模擬天氣邏輯 (依時間變換)
            const getTemp = (time) => {
                const hour = parseInt(time.split(':')[0]);
                if (hour < 6) return 12; // 清晨
                if (hour < 10) return 16; // 早上
                if (hour < 15) return 21; // 中午
                if (hour < 19) return 18; // 傍晚
                return 14; // 晚上
            };

            const getWeatherIcon = (time) => {
                const hour = parseInt(time.split(':')[0]);
                if (hour >= 6 && hour <= 17) return 'fa-solid fa-sun';
                return 'fa-solid fa-moon';
            };

            // 1. 行程資料
            const tripDays = ref([
                { dateShort: '3/28', dayName: 'SAT', events: [{ time: '08:00', title: 'Flight Departure', location: 'TPE Airport T2' }, { time: '16:00', title: 'Hotel Check-in', location: 'Osaka Namba' }] },
                { dateShort: '3/29', dayName: 'SUN', events: [{ time: '09:00', title: 'Sakura Photo Walk', location: 'Osaka Castle' }, { time: '18:00', title: 'Dotonbori Dinner', location: 'Namba' }] },
                { dateShort: '3/30', dayName: 'MON', events: [{ time: '10:00', title: 'Travel to Kyoto', location: 'Kyoto Station' }] },
                { dateShort: '3/31', dayName: 'TUE', events: [{ time: '05:00', title: 'Sunrise Shooting', location: 'Arashiyama' }] },
                { dateShort: '4/01', dayName: 'WED', events: [{ time: '10:00', title: 'Shinkansen to Tokyo', location: 'Tokyo Station' }] },
                { dateShort: '4/02', dayName: 'THU', events: [{ time: '10:00', title: 'Shopping', location: 'Shibuya Sky' }] },
                { dateShort: '4/03', dayName: 'FRI', events: [{ time: '09:00', title: 'Picnic', location: 'Shinjuku Gyoen' }] },
                { dateShort: '4/04', dayName: 'SAT', events: [{ time: '10:00', title: 'Last Buy', location: 'Ginza' }] },
                { dateShort: '4/05', dayName: 'SUN', events: [{ time: '14:00', title: 'Go Home', location: 'NRT Airport' }] },
            ]);

            const newEvent = ref({ time: '', title: '', location: '' });

            const selectDate = (index) => {
                activeDate.value = index;
                // 自動捲動讓選中的日期置中
                const el = document.getElementById('date-scroll').children[index];
                if(el) el.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            };

            const addEvent = () => {
                if(!newEvent.value.title) return;
                tripDays.value[activeDate.value].events.push({ ...newEvent.value });
                tripDays.value[activeDate.value].events.sort((a,b) => a.time.localeCompare(b.time));
                newEvent.value = { time: '', title: '', location: '' };
                showAddModal.value = false;
            };

            const deleteEvent = (index) => {
                if(confirm('Delete this plan?')) {
                    tripDays.value[activeDate.value].events.splice(index, 1);
                }
            };

            // 2. 分帳資料
            const members = ref(['Me', 'Alice', 'Bob']);
            const expenses = ref([
                { title: 'Izakaya Dinner', amount: 12000, payer: 'Me' },
                { title: 'USJ Tickets', amount: 25000, payer: 'Alice' },
            ]);
            const newExpense = ref({ title: '', amount: '', payer: 'Me' });

            const totalExpense = computed(() => expenses.value.reduce((acc, cur) => acc + cur.amount, 0));

            const addExpense = () => {
                if (!newExpense.value.title || !newExpense.value.amount) return;
                expenses.value.push({ ...newExpense.value });
                newExpense.value = { title: '', amount: '', payer: 'Me' };
            };
            
            const removeExpense = (idx) => expenses.value.splice(idx, 1);

            const settlements = computed(() => {
                let balances = {};
                members.value.forEach(m => balances[m] = 0);
                expenses.value.forEach(ex => {
                    balances[ex.payer] += ex.amount;
                });
                const perPerson = totalExpense.value / members.value.length;
                let debtors = [], creditors = [];
                for (let m in balances) {
                    const diff = balances[m] - perPerson;
                    if (diff < -1) debtors.push({ name: m, amount: Math.abs(diff) });
                    if (diff > 1) creditors.push({ name: m, amount: diff });
                }
                let result = [];
                let i = 0, j = 0;
                while (i < debtors.length && j < creditors.length) {
                    let amount = Math.min(debtors[i].amount, creditors[j].amount);
                    if (amount > 0) result.push({ from: debtors[i].name, to: creditors[j].name, amount: amount });
                    debtors[i].amount -= amount;
                    creditors[j].amount -= amount;
                    if (debtors[i].amount < 1) i++;
                    if (creditors[j].amount < 1) j++;
                }
                return result;
            });

            // 3. 地圖資料
            const savedLocations = ref([
                { name: 'Kiyomizu-dera', city: 'Kyoto', type: 'Sightseeing', query: 'Kiyomizu-dera Kyoto' },
                { name: 'Osaka Castle', city: 'Osaka', type: 'Photo Spot', query: 'Osaka Castle' },
                { name: 'Shinjuku Gyoen', city: 'Tokyo', type: 'Sakura', query: 'Shinjuku Gyoen National Garden' },
                { name: 'Dotonbori', city: 'Osaka', type: 'Food', query: 'Dotonbori Osaka' },
            ]);

            const openMap = (query) => {
                window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query)}`, '_blank');
            };

            const currentTabTitle = computed(() => {
                const titles = { schedule: 'Itinerary', money: 'Split Bill', map: 'Navigation' };
                return titles[currentTab.value];
            });

            return {
                currentTab, currentTabTitle,
                tripDays, activeDate, showAddModal, newEvent, addEvent, deleteEvent, selectDate,
                members, expenses, newExpense, addExpense, removeExpense, totalExpense, settlements,
                savedLocations, openMap, getTemp, getWeatherIcon
            };
        }
    }).mount('#app');
</script>

</body>
</html>
